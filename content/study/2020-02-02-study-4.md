---
title: "'웹을 지탱하는 기술' 4회차 스터디"
date: "2019-01-05"
template: "study"
description: 'Ch12~17'
---


## Json

Json(JavaScript Object Notation)은 데이터를 기술하기 위한 언어다. JavaScript의 기법으로 데이터를 기술할 수 있다. 심플해서 다른 언어로도 라이브러리로써 제공이 되고 많이 활용이 되고 있다.   
Json의 미디어 타입은 application/json입니다. 

``` javascript
Content-Type: application/json; charset=utf-8
```

json 파일의 확장자는 .json 이다.  

json에 6가지의 자료형이 있다.
- object
- array
- string
- number
- boolean
- null

object는 이름과 값의 집합이고 그 집합을 member이라고 한다. member의 이름은 무조건 문자열이고 member의 값은 위 6개 중 아무거나 된다.

``` javascript
{
    name: {
        first: 'gibong'
        last: 'yim'
    }
        age: 30
        isAlive: true
        placeTraveled: [ 'America', 'China', 'SouthEast Asia']
        friends: null
}
```

등으로 작성을 할수 있다.

시간을 표현할때 Unix 시간으로 시간을 표현하는데 이는 UTC(Universal Time Coordinate)인 1970년 1월 1일 시점부터 어느정도 시간이 지났는지 나타낸다. 나라 마다 시간이 다르므로 이것으로 표현하고 나중에 따로 각 국가의 GMT로 설정을 하든가 한다. 

Ajax에서 이용하는 XMLHttpRequest라는 JavaScript 모듈은 보안상의 제한으로 인하여 서버와 통신할때는 하나의 동일한 서버와 통신할수 밖에 없었다. 크로스 도메인 통신이 안되었다. 그래서 보안제한을 받지 않는 &lt;script&gt; 요소를 써서 이 문제를 대처하였다. 이러한 방법으로 JSONP를 써서 CORS를 형성한다. CORS는 Cross-Origin Resource Sharing 의 약자다. 위에 말했듯이 브라우저는 크로스 도메인 통신을 보안상 막는데 CORS 방식으로 헤더에 브라우저에게 다른 도메인의 정보들을 가져오게 한다. 


## 리소스 설계

리소스 설계란 클라이언트와 서버 간 인터페이스의 설계이다. 웹 서비스와 웹 API의 외부설계이다. 어떻게 리소스를 분할하고, URI로 이름을 붙이고, 상호 링크를 가지게 할지가 리소스 설계의 학심이다.  

리소스 설계할때 리소스 지향 아키텍처

- 웹 서비스에서 제공할 데이터를 특정한다.  
- 데이터를 리소스로 나눈다.  
- 리소스에 URI로 이름을 부여한다.  
- 클라이언트에 제공할 리소스의 표현을 설계한다.  
- 링크와 폼을 이용해 리소스와 리소스를 연결한다.  
- 이벤트의 표준적인 코스를 검토한다.  
- 에러에 대한 검토한다  

리소스란 웹상에 존재하는 이름이 부여된 정보이다.  
리소스는 URI로 이름을 부여를 할 수 있다.  
예를들어서 정보를 한 곳에 저장하고 그 URI를 ".../data/124125"로 하면 그 정보들은 124125 라는 식별문이 붙여진다, 고로 이름 부여가 된다. 

클라이언트에 제공할 리소스의 표현할때 많은 방법이 있다. 독자 XML, XHTML, Atom, Json, YAML, CSV, multimedia 등이 있다. 하나의 리소스가 복수의 포멧을 지원하면 좋다. XHTML은 XML을 이용하여 HTML 4.0.1을 새로 만든 독립언어이다. 현제는 HTML5 가 대세이므로 굳이 쓸 필요가 없다. Json은 내용이 함축적으로 최소한의 정보만을 가지고 있다. 그렇기 때문에 XML 에 비해 용량이 줄어들고 그만큼 빠른 속도를 가지게 된다. 언어에 독립적이며, 사용하기가 쉽다.  YAML은 읽기 쉽고 쓰기도 편하고 한글과 같은 유니코드를 그대로 사용할 수 있다.CSV는 "," 로 모든것을 분리하므로 읽기 소프트웨어를 쓸때 좋다.

링크와 폼을 이용해 리소스와 리소스를 연결할때는 보통 XML은 

``` html
<a href= "http://....">...</a>
```

로 표현하고 

JSON 같은 경우에는 

```javascript
"link": "http://..."
```

로한다. 

이벤트의 표준적인 코스를 검토할때 폼에 입력값을 입력 해서 원하는 리소스를 취득하면 된다. 그리고 에러가 뜰 때를 생각해서 404, 400, 405 등을 에러에 따라 반환하는 작업을 해야한다.  

## 쓰기 가능한 웹 서비스의 설계

읽기 전용과 달리 쓰기는 조금 더 고려할 사항이 있다. 예를들어서 동시 수정 같은 것들을 어떻게 처리 해야할지 고민을 해봐야한다. 

리소스 작성할때 펙토리 리소스에 POST 혹은 PUT이 있다. 팩토리 리소스는 리소스를 작성하기 위한 특별한 리소스이다. 사전 준비된 리소스에 POST로 새로운 리소스를 추가한다. PUT은 새로 작성하고 싶은 리소스의 URU에 직접 요청을 보냅니다. 이러한 방법은 POST를 지원하지 않아도 되고 클라이언트가 작성과 변경을 구별할 필요가 없어서 서버측의 구현이 간단해진다. 단 클라이언트가 URI 구조를 미리 알아야 하고 신규 작성인지 갱신인지 모른다. 

리소스 갱신할 때는 PUT으로 수행하고 일괄갱신은 POST 로 한다.그러나 요즘은 PATCH 로 갱신을 한다. 

``` JSON
PUT /999999 HTTP/1.1
Host: ...
Content-Type: application/json

{
    "zipcode":"99999"
    "address":{
        "prefecture":"a",
        "city":"b",
        "town":"c"
    },
    "hhi":{
        "prefecture":"aaa"
        "city":"bbb"
        "town":"ccc"
    }
}
```

이런 코드에서 한줄 바꿔서 보내면 벌크 업데이트라고 한다. 
아니면 아래 처럼 한줄만 바꿔서 보내는게 파셜 업데이트다 

``` 
PUT /999999 HTTP/1.1
Host: ...
Content-Type: application/json

    "hhi":{
        "prefecture":"ㅁㅁㅁ"
        "city":"ㅠㅠㅠ"
    }
```

갱신 할수 없을때를 고려해서 반환값을 지정해 주는것도 좋다.

리소스 삭제는 삭제하고 싶은 리소스의 URI에 delete를 보내서 삭제를 하면 된다. 그리고 일반적으로 부모 리소스에 소속된 자식 리소스는 부모 리소스가 삭제 되면 따라서 삭제가 된다. 리소스를 일괄 처리 할시에는 post를 쓰고 다 붙여서 쓰면 된다.

``` JSON
PUT /999999 HTTP/1.1
Host: ...
Content-Type: application/json

{
    "zipcode":"99999",
    "address":{
        "prefecture":"a",
        "city":"b",
        "town":"c"
    },
    "hhi":{
        "prefecture":"aaa",
        "city":"bbb",
        "town":"ccc"
    }
},
{
    "zipcode":"99998",
    "address":{
        "prefecture":"a",
        "city":"b",
        "town":"ㅇ"
    },
    "hhi":{
        "prefecture":"aaa",
        "city":"bbb",
        "town":"ㅇㅇㅇ"
    }
}
```

일괄처리를 transaction화 하여 도중에 처리를 실패 할 경우에 아무것도 처리를 안했다는 보증을 한다. 

트랜잭션이란 요청이나 반영한 곳에서 이벤트가 생겼을시에 양쪽 처리가 모두 성공하거나 실패했을 경우에 둘다 원래대로 돌아가게끔 보증하는것이다. 문제가 있을시에는 rollback를 하고 성공 할 시에는 commit을 한다. 